# Public Booking - Quick Start Guide

## Quick Test (3 steps)

### Step 1: Add slug field to database
```bash
cd /home/ubuntu/smart-business-assistant/apps/api

# Connect to PostgreSQL
psql -U postgres -d smart_business_assistant

# Add slug column
ALTER TABLE tenants ADD COLUMN slug VARCHAR(255) UNIQUE;

# Exit psql
\q
```

### Step 2: Generate slugs for existing tenants
```bash
cd /home/ubuntu/smart-business-assistant/apps/api
npx ts-node src/scripts/add-tenant-slug.ts
```

This will automatically create URL-friendly slugs for all your tenants based on their names.

### Step 3: Visit booking page
```
http://localhost:3000/book/[tenant-slug]
```

Replace `[tenant-slug]` with the slug generated in Step 2.

## Example Flow

If you have a tenant named "Acme Plumbing":
1. Script generates slug: `acme-plumbing`
2. Visit: `http://localhost:3000/book/acme-plumbing`
3. Customer sees available services
4. Customer selects service → date → time
5. Customer enters contact info
6. Booking confirmed!

## Requirements

Before testing, ensure:
- [ ] API is running on port 3001
- [ ] Web app is running on port 3000
- [ ] PostgreSQL database is running
- [ ] At least one tenant exists in database
- [ ] Tenant has at least one service configured

## Sample Test Data

Create a test tenant and service:

```typescript
// Via API or database
Tenant: {
  name: "Test Business",
  slug: "test-business",  // Auto-generated by script
  email: "test@example.com"
}

Service: {
  name: "Initial Consultation",
  description: "30-minute consultation",
  durationMinutes: 30,
  price: 50.00,
  tenantId: "[tenant-id]"
}
```

## URL Examples

Different tenant slugs generate different booking URLs:

| Business Name | Generated Slug | Booking URL |
|--------------|----------------|-------------|
| Acme Plumbing | `acme-plumbing` | `/book/acme-plumbing` |
| Joe's Auto Shop | `joes-auto-shop` | `/book/joes-auto-shop` |
| ABC Consulting | `abc-consulting` | `/book/abc-consulting` |
| Smith & Co. | `smith-co` | `/book/smith-co` |

## Troubleshooting

### "Business not found"
- Check if tenant has a slug in database
- Verify slug matches URL
- Run the add-tenant-slug.ts script

### "No services available"
- Add at least one service to the tenant
- Check that service has tenantId matching the tenant

### "Failed to load time slots"
- Verify API is running on correct port
- Check NEXT_PUBLIC_API_URL in .env.local
- Look at browser console for errors

### Calendar shows no dates
- Check if maxDaysAhead is set correctly
- Verify date picker component is receiving props

## Development URLs

- Web App: http://localhost:3000
- API: http://localhost:3001
- Booking Page: http://localhost:3000/book/[slug]

## API Testing with cURL

Test the API endpoints directly:

```bash
# Get tenant by slug
curl http://localhost:3001/api/v1/public/tenants/slug/test-business

# Get services
curl http://localhost:3001/api/v1/public/tenants/[tenant-id]/services

# Get time slots
curl "http://localhost:3001/api/v1/public/tenants/[tenant-id]/services/[service-id]/slots?date=2026-01-24"

# Create booking
curl -X POST http://localhost:3001/api/v1/public/tenants/[tenant-id]/bookings \
  -H "Content-Type: application/json" \
  -d '{
    "serviceId": "[service-id]",
    "scheduledAt": "2026-01-24T10:00:00Z",
    "customer": {
      "name": "John Doe",
      "email": "john@example.com",
      "phone": "+1234567890",
      "notes": "First time customer"
    }
  }'
```

## File Locations

### Frontend Components
```
apps/web/components/booking/
├── service-selector.tsx
├── date-picker.tsx
├── time-slot-selector.tsx
├── customer-form.tsx
└── booking-confirmation.tsx
```

### Booking Page
```
apps/web/app/book/[tenantSlug]/page.tsx
```

### API Module
```
apps/api/src/modules/public-booking/
├── public-booking.controller.ts
├── public-booking.service.ts
├── public-booking.module.ts
└── dto/create-public-booking.dto.ts
```

## Next Steps

After basic testing works:

1. **Customize business hours**: Modify time slot generation in `public-booking.service.ts`
2. **Add email notifications**: Integrate with Resend or similar service
3. **Configure holidays**: Add business closure dates
4. **Enable payments**: Add Stripe integration
5. **Customize styling**: Update component styles for business branding

## Support

For issues or questions:
- Check console logs in browser and API server
- Review BOOKING_README.md for detailed documentation
- See BOOKING_IMPLEMENTATION.md for technical details
